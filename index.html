<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>LUFFY EYES</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />
  <style>
    body { font-family: 'Inter', sans-serif; }
    .fade-in { animation: fadeIn 0.5s ease-in-out; }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">

  <!-- LOGIN -->
  <div id="login" class="w-full max-w-md bg-white shadow-lg rounded-xl p-6 space-y-4 fade-in">
    <h2 class="text-2xl font-bold text-center text-blue-600">üîê Acesso ao LUFFY EYES</h2>
    <input id="user" type="text" placeholder="Usu√°rio" class="w-full p-2 border rounded" />
    <input id="pass" type="password" placeholder="Senha" class="w-full p-2 border rounded" />
    <button onclick="entrar()" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-2 rounded">Entrar</button>
    <div id="erroLogin" class="text-red-500 text-sm hidden">Usu√°rio ou senha incorretos.</div>
  </div>

  <!-- PAINEL -->
  <div id="painel" class="hidden w-full max-w-4xl bg-white rounded-2xl shadow-xl p-6 space-y-6 fade-in">
    <div class="flex justify-between items-center">
      <h1 class="text-2xl font-bold text-blue-600">üîéLUFFY EYES</h1>
      <div>
        <button onclick="mostrarUsuarios()" class="text-sm text-blue-600 mr-4 hover:underline">üë§ Usu√°rios</button>
        <button onclick="logout()" class="text-sm text-red-500 hover:underline">Sair</button>
      </div>
    </div>

    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
      <div>
        <label class="block text-sm font-medium text-gray-700">Base de busca</label>
        <select id="base" class="mt-1 block w-full p-2 border-gray-300 rounded-md">
          <option value="cpf">CPF</option>
          <option value="cnpj">CNPJ</option>
          <option value="rg">RG</option>
          <option value="cpfsimpl">CPF Simples</option>
          <option value="rgsimpl">RG Simples</option>
          <option value="nome">Nome</option>
          <option value="pis">PIS</option>
          <option value="titulo">T√≠tulo</option>
          <option value="telefone">Telefone</option>
          <option value="email">Email</option>
          <option value="cns">CNS</option>
          <option value="mae">M√£e</option>
          <option value="pai">Pai</option>
          <option value="placa">Placa</option>
          <option value="chassi">Chassi</option>
          <option value="renavam">Renavam</option>
          <option value="motor">Motor</option>
          <option value="fotorj">Foto RJ</option>
          <option value="fotosp">Foto SP</option>
          <option value="funcionarios">Funcion√°rios</option>
          <option value="razao">Raz√£o Social</option>
        </select>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">Informa√ß√£o</label>
        <input id="info" class="mt-1 block w-full p-2 border-gray-300 rounded-md" placeholder="ex: CPF, Nome..." />
      </div>
    </div>

    <div class="flex items-center gap-2">
      <button onclick="consultar()" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 rounded-md">Consultar</button>
      <button onclick="exportarJSON()" class="text-sm px-3 py-2 bg-gray-200 rounded hover:bg-gray-300">‚¨áÔ∏è Exportar</button>
    </div>

    <div id="resultado" class="font-mono text-gray-800 bg-gray-50 p-4 rounded-md h-80 overflow-y-auto">
      üìù Resultado aparecer√° aqui...
    </div>
  </div>

  <!-- MODAL USU√ÅRIOS -->
  <div id="modalUsuarios" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center">
    <div class="bg-white rounded-xl p-6 max-w-md w-full">
      <h2 class="text-lg font-bold mb-2">üîß Gerenciar Usu√°rios</h2>
      <ul id="listaUsuarios" class="mb-4"></ul>
      <input type="text" id="novoUsuario" class="w-full p-2 mb-2 border rounded" placeholder="Novo usu√°rio" />
      <input type="password" id="novaSenha" class="w-full p-2 mb-4 border rounded" placeholder="Senha" />
      <div class="flex justify-end gap-2">
        <button onclick="fecharUsuarios()" class="text-gray-500 hover:underline">Cancelar</button>
        <button onclick="adicionarUsuario()" class="bg-blue-600 text-white px-4 py-1 rounded hover:bg-blue-700">Salvar</button>
      </div>
    </div>
  </div>

  <script>
    let autorizados = {
      "luffy": "12345",
      "admin": "admin123"
    };
    let usuarioAtual = null;

    function entrar() {
      const user = document.getElementById("user").value.trim();
      const pass = document.getElementById("pass").value.trim();
      const erro = document.getElementById("erroLogin");
      if (autorizados[user] === pass) {
        usuarioAtual = user;
        document.getElementById("login").classList.add("hidden");
        document.getElementById("painel").classList.remove("hidden");
        erro.classList.add("hidden");
      } else {
        erro.classList.remove("hidden");
      }
    }

    function logout() {
      document.getElementById("login").classList.remove("hidden");
      document.getElementById("painel").classList.add("hidden");
      usuarioAtual = null;
    }

    async function consultar() {
      const base = document.getElementById("base").value;
      const info = encodeURIComponent(document.getElementById("info").value.trim());
      const resultado = document.getElementById("resultado");

      if (!info) {
        resultado.innerText = "‚ùå Preencha o campo de informa√ß√£o.";
        return;
      }

      resultado.innerHTML = "‚è≥ Consultando...";
      const url = `/api/proxy?base=${base}&info=${info}`;

      try {
        const res = await fetch(url);
        const data = await res.json();
        resultado.innerHTML = renderData(data);
      } catch (err) {
        resultado.innerText = "‚ö†Ô∏è Erro ao buscar os dados:\n" + err.message;
      }
    }

    function renderData(data) {
      if (typeof data !== "object") return `<div>${data}</div>`;
      if (Array.isArray(data)) {
        if (data.length === 0) return "<div>üîç Nenhum resultado encontrado.</div>";
        return data.map(item => `<div class="mb-4 border-b pb-2">${renderData(item)}</div>`).join("");
      }
      return `<div class="space-y-1">${Object.entries(data).map(([k, v]) => `<div><strong>${k}</strong>: ${formatValue(v)}</div>`).join("")}</div>`;
    }

    function formatValue(val) {
      if (typeof val === "object" && val !== null) {
        return `<pre class="bg-gray-100 p-2 rounded">${JSON.stringify(val, null, 2)}</pre>`;
      }
      return val === "" || val === null ? "<span class='text-gray-500'>(vazio)</span>" : val;
    }

    function exportarJSON() {
      const resultado = document.getElementById('resultado').innerText;
      const blob = new Blob([resultado], { type: "application/json" });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = `resultado_${Date.now()}.json`;
      link.click();
    }

    function mostrarUsuarios() {
      const lista = document.getElementById("listaUsuarios");
      lista.innerHTML = Object.entries(autorizados).map(([user]) => `<li>${user}</li>`).join("");
      document.getElementById("modalUsuarios").classList.remove("hidden");
    }

    function fecharUsuarios() {
      document.getElementById("modalUsuarios").classList.add("hidden");
    }

    function adicionarUsuario() {
      const user = document.getElementById("novoUsuario").value.trim();
      const pass = document.getElementById("novaSenha").value.trim();
      if (user && pass) {
        autorizados[user] = pass;
        alert(`Usu√°rio '${user}' adicionado!`);
        mostrarUsuarios();
      }
    }
  </script>
</body>
</html>
